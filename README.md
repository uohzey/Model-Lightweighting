



# Model-Lightweighting

note:

- 创建DataLoader时,shuffle=True时可以设置num_workers数量,shuffle=False时不需要设置num_workers
- GPU内存不足
  - 减小批量大小(batch size)
  - 使用梯度累计
  - 减小模型复杂度
  - 使用混合精度进行训练
  - 减小输入图像尺寸

| 数据集        | 模型架构       | 参数    | 任务           | 耗时                      | device      | CPU/GPU  | acc    |
| ------------- | -------------- | ------- | -------------- | ------------------------- | ----------- | -------- | ------ |
| imagenet-mini | resnet-18-精简 | 20.36MB | classification | 3405.97s/68.12s per epoch | 3060 laptop | 40%/100% | 17%    |
| imagenet-mini | resnet-18-精简 | 44.1MB  | classification | 3635.38s/121.18 per epoch | 3060 laptop | 40%/100% | 19.35% |
|               |                |         |                |                           |             |          |        |



- 2025/01/26

  - resnet-18-精简

  - 模型架构

    ```
            Layer (type)               Output Shape         Param #
    ================================================================
                Conv2d-1         [-1, 64, 228, 228]           1,728
           BatchNorm2d-2         [-1, 64, 228, 228]             128
                  ReLU-3         [-1, 64, 228, 228]               0
             MaxPool2d-4         [-1, 64, 114, 114]               0
                Conv2d-5        [-1, 128, 114, 114]          73,728
           BatchNorm2d-6        [-1, 128, 114, 114]             256
                  ReLU-7        [-1, 128, 114, 114]               0
                Conv2d-8        [-1, 128, 114, 114]         147,456
           BatchNorm2d-9        [-1, 128, 114, 114]             256
               Conv2d-10        [-1, 128, 114, 114]           8,192
          BatchNorm2d-11        [-1, 128, 114, 114]             256
                 ReLU-12        [-1, 128, 114, 114]               0
        ResidualBlock-13        [-1, 128, 114, 114]               0
               Conv2d-14          [-1, 256, 57, 57]         294,912
          BatchNorm2d-15          [-1, 256, 57, 57]             512
                 ReLU-16          [-1, 256, 57, 57]               0
               Conv2d-17          [-1, 256, 57, 57]         589,824
          BatchNorm2d-18          [-1, 256, 57, 57]             512
               Conv2d-19          [-1, 256, 57, 57]          32,768
          BatchNorm2d-20          [-1, 256, 57, 57]             512
                 ReLU-21          [-1, 256, 57, 57]               0
        ResidualBlock-22          [-1, 256, 57, 57]               0
               Conv2d-23          [-1, 512, 29, 29]       1,179,648
          BatchNorm2d-24          [-1, 512, 29, 29]           1,024
                 ReLU-25          [-1, 512, 29, 29]               0
               Conv2d-26          [-1, 512, 29, 29]       2,359,296
          BatchNorm2d-27          [-1, 512, 29, 29]           1,024
               Conv2d-28          [-1, 512, 29, 29]         131,072
          BatchNorm2d-29          [-1, 512, 29, 29]           1,024
                 ReLU-30          [-1, 512, 29, 29]               0
        ResidualBlock-31          [-1, 512, 29, 29]               0
    AdaptiveAvgPool2d-32            [-1, 512, 1, 1]               0
               Linear-33                 [-1, 1000]         513,000
    ================================================================
    Total params: 5,337,128
    Trainable params: 5,337,128
    Non-trainable params: 0
    ----------------------------------------------------------------
    Input size (MB): 0.57
    Forward/backward pass size (MB): 283.41
    Params size (MB): 20.36
    Estimated Total Size (MB): 304.34
    ```





- 

  - acc:19.35%

  - ```
    ----------------------------------------------------------------
            Layer (type)               Output Shape         Param #
    ================================================================
                Conv2d-1         [-1, 64, 228, 228]           1,728
           BatchNorm2d-2         [-1, 64, 228, 228]             128
                  ReLU-3         [-1, 64, 228, 228]               0
             MaxPool2d-4         [-1, 64, 114, 114]               0
                Conv2d-5        [-1, 128, 114, 114]          73,728
           BatchNorm2d-6        [-1, 128, 114, 114]             256
                  ReLU-7        [-1, 128, 114, 114]               0
                Conv2d-8        [-1, 128, 114, 114]         147,456
           BatchNorm2d-9        [-1, 128, 114, 114]             256
               Conv2d-10        [-1, 128, 114, 114]           8,192
          BatchNorm2d-11        [-1, 128, 114, 114]             256
                 ReLU-12        [-1, 128, 114, 114]               0
        ResidualBlock-13        [-1, 128, 114, 114]               0
               Conv2d-14        [-1, 128, 114, 114]         147,456
          BatchNorm2d-15        [-1, 128, 114, 114]             256
                 ReLU-16        [-1, 128, 114, 114]               0
               Conv2d-17        [-1, 128, 114, 114]         147,456
          BatchNorm2d-18        [-1, 128, 114, 114]             256
                 ReLU-19        [-1, 128, 114, 114]               0
        ResidualBlock-20        [-1, 128, 114, 114]               0
               Conv2d-21          [-1, 256, 57, 57]         294,912
          BatchNorm2d-22          [-1, 256, 57, 57]             512
                 ReLU-23          [-1, 256, 57, 57]               0
               Conv2d-24          [-1, 256, 57, 57]         589,824
          BatchNorm2d-25          [-1, 256, 57, 57]             512
               Conv2d-26          [-1, 256, 57, 57]          32,768
          BatchNorm2d-27          [-1, 256, 57, 57]             512
                 ReLU-28          [-1, 256, 57, 57]               0
        ResidualBlock-29          [-1, 256, 57, 57]               0
               Conv2d-30          [-1, 256, 57, 57]         589,824
          BatchNorm2d-31          [-1, 256, 57, 57]             512
                 ReLU-32          [-1, 256, 57, 57]               0
               Conv2d-33          [-1, 256, 57, 57]         589,824
          BatchNorm2d-34          [-1, 256, 57, 57]             512
                 ReLU-35          [-1, 256, 57, 57]               0
        ResidualBlock-36          [-1, 256, 57, 57]               0
               Conv2d-37          [-1, 512, 29, 29]       1,179,648
          BatchNorm2d-38          [-1, 512, 29, 29]           1,024
                 ReLU-39          [-1, 512, 29, 29]               0
               Conv2d-40          [-1, 512, 29, 29]       2,359,296
          BatchNorm2d-41          [-1, 512, 29, 29]           1,024
               Conv2d-42          [-1, 512, 29, 29]         131,072
          BatchNorm2d-43          [-1, 512, 29, 29]           1,024
                 ReLU-44          [-1, 512, 29, 29]               0
        ResidualBlock-45          [-1, 512, 29, 29]               0
               Conv2d-46          [-1, 512, 29, 29]       2,359,296
          BatchNorm2d-47          [-1, 512, 29, 29]           1,024
                 ReLU-48          [-1, 512, 29, 29]               0
               Conv2d-49          [-1, 512, 29, 29]       2,359,296
          BatchNorm2d-50          [-1, 512, 29, 29]           1,024
                 ReLU-51          [-1, 512, 29, 29]               0
        ResidualBlock-52          [-1, 512, 29, 29]               0
    AdaptiveAvgPool2d-53            [-1, 512, 1, 1]               0
               Linear-54                 [-1, 1000]         513,000
    ================================================================
    Total params: 11,533,864
    Trainable params: 11,533,864
    Non-trainable params: 0
    ----------------------------------------------------------------
    Input size (MB): 0.57
    Forward/backward pass size (MB): 439.66
    Params size (MB): 44.00
    Estimated Total Size (MB): 484.23
    ----------------------------------------------------------------
    ```